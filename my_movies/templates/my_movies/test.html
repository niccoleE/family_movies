{% extends 'my_movies/base.html' %}
{% load extras %}

{% block page_header %}

{% endblock page_header %}

{% block content %}

      <div>
        <a class="link-dark" href="{% url 'my_movies:movie' movie.id %}"><h3>{{ movie }}</h3></a><h4>&#11088 {{ movie.rating }}</h4>
      </div>

  {% for comment in comments %}
    <div class="row">

      <div class="col-md-1">
        <img class="rounded mx-auto d-block w-100 border border-dark p-2" src="https://styles.redditmedia.com/t5_2qqcn/styles/communityIcon_de3pi2i14o551.png" alt="user">
      </div>

      <div class="col-md-11">
        <b> {{comment.owner}} </b> {{ comment.date_added|date:'M d, Y H:i'}}
        <p>{{comment}}</p>

        <div class="reply mx-0">

          <button class="btn btn-sm btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#renderForm">
            Reply
          </button>

          <a data-bs-toggle="collapse" data-bs-target="#repls">
            Replies
          </a>

          {% for reply in replyDict|get_val:comment.id %}

          <div class="collapse" id="repls">
            <div class="card">
              <div class="card-body">
                <b>{{ reply.owner }}</b> {{ reply.date_added|date:'M d, Y H:i'}}
                <p>{{ reply }}</p>
              </div>
            </div>
          </div>
         {% endfor %}
      </div>

      <div class="collapse" id="renderForm">
        <div class="card card-body my-2">
          <form action="{% url 'my_movies:new_comment' movie.id %}" method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <div>
              <label for="comment">Post a reply </label>
              <input type="text" class="form-control" id="comment" name="reply" placeholder="Enter comment here">
              <input type="hidden" name="parentId" value="{{comment.id}}">
            </div>
            <button type="submit" class="btn btn-sm btn-primary">Submit</button>
          </form>

        </div>
      </div>
    </div>
 {% endfor %}

{% endblock content%}